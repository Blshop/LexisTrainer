<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   <script src="{{url_for('static', filename='main.js')}}"></script>
   <title>Document</title>
   <link rel="stylesheet" href="/static/main.css">
</head>

<body>
   <div class="container">
      <div class="status">
         <p>Current word number <span id="current"></span> out of <span id="all"></span></p>
      </div>
      <p id="1"></p><br>
      <div class="translations">
         <div class="trans" id="one">
            <p id="part-0">part</p>
            <label for="translation-1">translation</label>
            <textarea id="translation-0" name="translation-0" placeholder="translation-1"></textarea>
         </div>
         <div class="trans" id="two">
            <p id="part-1">part</p>
            <label for="translation-2">translation</label>
            <textarea id="translation-1" name="translation-1" placeholder="translation-2"></textarea>
         </div>
         <div class="trans" id="three">
            <p id="part-2">part</p>
            <label for="translation-2">translation</label>
            <textarea id="translation-2" name="translation-3" placeholder="translation-3"></textarea>
         </div>
      </div>
      <button id="5" style="height: 30px; width: 200px;">correct</button><br>
      <button id="6" style="height: 30px; width: 200px; margin-top: 40px ;">wrong</button><br>
      <button id="7" style="height: 30px; width: 200px; margin-top: 140px ;">finish</button>
   </div>
   <script type="text/javascript">
      let list_data = {{ words | safe }}
      let word_number = 0;
      let max_words = Object.keys(list_data).length
      let keys = Object.keys(list_data)
      let random
      let ru_word
      document.getElementById("all").innerHTML = max_words
      next_word()

      document.getElementById("5").addEventListener("click", addvalue);
      document.getElementById("6").addEventListener("click", minusvalue);
      document.getElementById("7").addEventListener("click", finish);
      document.getElementById("translation-0").addEventListener("click", show);
      document.getElementById("translation-1").addEventListener("click", show);
      document.getElementById("translation-2").addEventListener("click", show);

      function show() {
         document.getElementById("translation-0").style.color = 'black'
         document.getElementById("translation-1").style.color = 'black'
         document.getElementById("translation-2").style.color = 'black'
      }

      function finish() {
         $(document).ready(function () {
            var data = {
               data: JSON.stringify(list_data)
            }
            $.ajax({
               url: "/finish",
               type: 'POST',
               data: data,
               success: function (msg) {
                  alert(msg.name)
               }
            })
         });
      }

      function next_word() {
         document.getElementById("translation-0").style.color = 'white'
         document.getElementById("translation-1").style.color = 'white'
         document.getElementById("translation-2").style.color = 'white'
         document.getElementById("part-0").style.color = 'white'
         document.getElementById("part-1").style.color = 'white'
         document.getElementById("part-2").style.color = 'white'
         document.getElementById("translation-0").innerHTML = ''
         document.getElementById("translation-1").innerHTML = ''
         document.getElementById("translation-2").innerHTML = ''

         if (max_words > word_number) {
            word_number += 1
            random = Math.floor(Math.random() * keys.length)
            ru_word = keys[random]
            parts = Object.keys(list_data[ru_word])
            console.log(parts)
            keys.splice(random, 1)
            document.getElementById("current").innerHTML = word_number
            document.getElementById("1").innerHTML = ru_word
            for (i in parts) {
               document.getElementById('part-' + i).innerHTML = parts[i]
               document.getElementById("part-" + i).style.color = 'black'
               document.getElementById("translation-" + i).innerHTML = list_data[ru_word][parts[i]][1].join('\r\n')
            }
            // document.getElementById("2").innerHTML = ''
            // document.getElementById("3").innerHTML = list_data[word_number][2]
            // document.getElementById("4").innerHTML = list_data[word_number][3]
         }

      }
      function minusvalue() {
         if (list_data[ru_word][0] > 0) {
            list_data[ru_word][0] -= 10
         }
         if (word_number == max_words) {
            document.getElementById("translation-0").innerHTML = 'Finished'
            document.getElementById("translation-1").innerHTML = 'Finished'
            document.getElementById("translation-2").innerHTML = 'Finished'
         }
         else {
            next_word()
         }
      }

      function addvalue() {
         list_data[ru_word][0] += 10
         if (word_number == max_words) {
            document.getElementById("2").innerHTML = 'Finished'
         }
         else { next_word() }


      }
   </script>
</body>

</html>